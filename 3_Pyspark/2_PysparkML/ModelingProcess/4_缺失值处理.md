
```
# 剔除类别特征值大于32（默认）
def drop_distinct_count(df, thresh=32, _id='id'):
    strCol = [i for i, j in df.dtypes if j=='string' and i!=_id]
    ls = []
    for i in strCol:
        ls.append((df.select(i).distinct().count(), i))
    return df.drop(*[j for i, j in ls if i > thresh])

df = spark.table('fbidm.yuanjie_data_9')

# numCol
numColName1 = [i for i in df.columns if re.search('\d+m|\d*days', i)] + ['score']
numColName2 = ['debt_st',
               'is_mi_fan',
               'is_htc_fan',
               'is_4g',
               'fin_rgst_drtn',
               'cfc_open_drtn',
               'commute_vst_lvl',
               'weekend_vst_lvl',
               'cfc_amt',
               'mgt_store',
               'gds_cgy_love',
               'is_apple_fan',
               'app_hold',
               'is_lenovo_fan',
               'cfc_tml_love',
               'rest_tm_vst_lvl',
               'is_myhz_buyer',
               'auth_type',
               'is_sony_fan',
               'work_dt_vst_lvl',
               'fin_lifecycle',
               'lifecycle',
               'is_3c_buyer',
               'chp_tml_love',
               'work_tm_vst_lvl',
               'is_myhz_buyer_offline',
               'is_nokia_fan',
               'identy',
               'value_lvl',
               'loyal_lvl',
               'is_other_buyer_offline',
               'is_other_buyer',
               'mgt_org',
               'loyalty_level',
               'chn_love',
               'cfc_pay_1st_drtn',
               'epp_non_actv_mem_lvl',
               'eqmt_num',
               'work_life',
               'chnel_cnt',
               'bind_card_num',
               'first_epp_bag_drtn',
               'is_samsung_fan',
               'pay_amt_d',
               'is_oppo_fan',
               'is_huwei_fan',
               'epp_actv_lvl_mon',
               'cfc_rgst_drtn',
               'income',
               'first_buy_goods_type',
               'epp_balance',
               'first_epp_pay_drtn',
               'plsa_customer_src',
               'epp_member_lvl',
               'mem_sts',
               'night_vst_lvl',
               'is_zte_fan',
               'age_type',
               'eg_mem_lvl',
               'epp_lifecycle',
               'actv_rfr_on']

# 类别转换及缺失值填补
numColName = numColName1 + numColName2
_numCol = [col(i).astype(FloatType()).name('_' + i) for i in numColName]
_numColName2 = ['_' + i for i in numColName2]
df = df.select('*', *_numCol).fillna(-999, _numColName2).fillna('_NA').fillna(0).drop(*numColName)

# 剔除类别特征值大于32（默认）
df = drop_distinct_count(df, _id='acct_no')

df.write.saveAsTable('fbidm.yuanjie_train_data', mode='overwrite')
```
